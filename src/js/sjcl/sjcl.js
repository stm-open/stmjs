"use strict";function nbits(t){var e,s=1;return 0!=(e=t>>>16)&&(t=e,s+=16),0!=(e=t>>8)&&(t=e,s+=8),0!=(e=t>>4)&&(t=e,s+=4),0!=(e=t>>2)&&(t=e,s+=2),0!=(e=t>>1)&&(t=e,s+=1),s}function getRandSFromSignature(t,e){var s=t.r.bitLength();return{r:sjcl.bn.fromBits(sjcl.bitArray.bitSlice(e,0,s)),s:sjcl.bn.fromBits(sjcl.bitArray.bitSlice(e,s,sjcl.bitArray.bitLength(e)))}}function calculateRecoveryFactor(t,e,s,i,r){for(var n=r.toBits(),c=0;c<4;c++){var o;try{o=recoverPublicKeyPointFromSignature(t,e,s,i,c)}catch(t){continue}if(sjcl.bitArray.equal(o.toBits(),n))return c}throw new sjcl.exception.bug("unable to calculate recovery factor from signature")}function recoverPublicKeyPointFromSignature(t,e,s,i,r){var n=t.r,c=t.field.modulus;r&=3;var o,l=1&r,a=r>>1;FIELD_MODULUS_PLUS_ONE_DIVIDED_BY_FOUR||(FIELD_MODULUS_PLUS_ONE_DIVIDED_BY_FOUR=c.add(1).div(4)),o=a?e.add(n):e;var h,u=o.mul(o).mul(o).add(t.a.mul(o)).add(t.b).mod(c),f=u.powermodMontgomery(FIELD_MODULUS_PLUS_ONE_DIVIDED_BY_FOUR,c),d=f.mod(2).equals(0);h=d&&!l||!d&&l?f:c.sub(f);var b=new sjcl.ecc.point(t,o,h);if(!b.isValidPoint())throw new sjcl.exception.corrupt("point R. Not a valid point on the curve. Cannot recover public key");var p=sjcl.bn.fromBits(i),m=new sjcl.bn(0).sub(p).mod(n),_=e.inverseMod(n),g=b.mult2(s,m,t.G).mult(_);if(!g.isValidPoint())throw new sjcl.exception.corrupt("public_key_point. Not a valid point on the curve. Cannot recover public key");if(!verify_raw(t,p,e,s,g))throw new sjcl.exception.corrupt("cannot recover public key");return g}function verify_raw(t,e,s,i,r){var n=t.r;if(new sjcl.bn(1).greaterEquals(s)||s.greaterEquals(new sjcl.bn(n)))return!1;if(new sjcl.bn(1).greaterEquals(i)||i.greaterEquals(new sjcl.bn(n)))return!1;var c=i.inverseMod(n),o=e.mul(c).mod(n),l=s.mul(c).mod(n),a=t.G.mult2(o,l,r);return s.equals(a.x.mod(n))}var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};"undefined"!=typeof module&&module.exports&&(module.exports=sjcl),sjcl.cipher.aes=function(t){this._tables[0][0][0]||this._precompute();var e,s,i,r,n,c=this._tables[0][4],o=this._tables[1],l=t.length,a=1;if(4!==l&&6!==l&&8!==l)throw new sjcl.exception.invalid("invalid aes key size");for(this._key=[r=t.slice(0),n=[]],e=l;e<4*l+28;e++)i=r[e-1],(e%l==0||8===l&&e%l==4)&&(i=c[i>>>24]<<24^c[i>>16&255]<<16^c[i>>8&255]<<8^c[255&i],e%l==0&&(i=i<<8^i>>>24^a<<24,a=a<<1^283*(a>>7))),r[e]=r[e-l]^i;for(s=0;e;s++,e--)i=r[3&s?e:e-4],n[s]=e<=4||s<4?i:o[0][c[i>>>24]]^o[1][c[i>>16&255]]^o[2][c[i>>8&255]]^o[3][c[255&i]]},sjcl.cipher.aes.prototype={encrypt:function(t){return this._crypt(t,0)},decrypt:function(t){return this._crypt(t,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var t,e,s,i,r,n,c,o,l,a=this._tables[0],h=this._tables[1],u=a[4],f=h[4],d=[],b=[];for(t=0;t<256;t++)b[(d[t]=t<<1^283*(t>>7))^t]=t;for(e=s=0;!u[e];e^=i||1,s=b[s]||1)for(c=s^s<<1^s<<2^s<<3^s<<4,c=c>>8^255&c^99,u[e]=c,f[c]=e,n=d[r=d[i=d[e]]],l=16843009*n^65537*r^257*i^16843008*e,o=257*d[c]^16843008*c,t=0;t<4;t++)a[t][e]=o=o<<24^o>>>8,h[t][c]=l=l<<24^l>>>8;for(t=0;t<5;t++)a[t]=a[t].slice(0),h[t]=h[t].slice(0)},_crypt:function(t,e){if(4!==t.length)throw new sjcl.exception.invalid("invalid aes block size");var s,i,r,n,c=this._key[e],o=t[0]^c[0],l=t[e?3:1]^c[1],a=t[2]^c[2],h=t[e?1:3]^c[3],u=c.length/4-2,f=4,d=[0,0,0,0],b=this._tables[e],p=b[0],m=b[1],_=b[2],g=b[3],j=b[4];for(n=0;n<u;n++)s=p[o>>>24]^m[l>>16&255]^_[a>>8&255]^g[255&h]^c[f],i=p[l>>>24]^m[a>>16&255]^_[h>>8&255]^g[255&o]^c[f+1],r=p[a>>>24]^m[h>>16&255]^_[o>>8&255]^g[255&l]^c[f+2],h=p[h>>>24]^m[o>>16&255]^_[l>>8&255]^g[255&a]^c[f+3],f+=4,o=s,l=i,a=r;for(n=0;n<4;n++)d[e?3&-n:n]=j[o>>>24]<<24^j[l>>16&255]<<16^j[a>>8&255]<<8^j[255&h]^c[f++],s=o,o=l,l=a,a=h,h=s;return d}},sjcl.bitArray={bitSlice:function(t,e,s){return t=sjcl.bitArray._shiftRight(t.slice(e/32),32-(31&e)).slice(1),void 0===s?t:sjcl.bitArray.clamp(t,s-e)},extract:function(t,e,s){var i,r=Math.floor(-e-s&31);return i=-32&(e+s-1^e)?t[e/32|0]<<32-r^t[e/32+1|0]>>>r:t[e/32|0]>>>r,i&(1<<s)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var s=t[t.length-1],i=sjcl.bitArray.getPartial(s);return 32===i?t.concat(e):sjcl.bitArray._shiftRight(e,i,0|s,t.slice(0,t.length-1))},bitLength:function(t){var e,s=t.length;return 0===s?0:(e=t[s-1],32*(s-1)+sjcl.bitArray.getPartial(e))},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var s=t.length;return e&=31,s>0&&e&&(t[s-1]=sjcl.bitArray.partial(e,t[s-1]&2147483648>>e-1,1)),t},partial:function(t,e,s){return 32===t?e:(s?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(sjcl.bitArray.bitLength(t)!==sjcl.bitArray.bitLength(e))return!1;var s,i=0;for(s=0;s<t.length;s++)i|=t[s]^e[s];return 0===i},_shiftRight:function(t,e,s,i){var r,n,c=0;for(void 0===i&&(i=[]);e>=32;e-=32)i.push(s),s=0;if(0===e)return i.concat(t);for(r=0;r<t.length;r++)i.push(s|t[r]>>>e),s=t[r]<<32-e;return c=t.length?t[t.length-1]:0,n=sjcl.bitArray.getPartial(c),i.push(sjcl.bitArray.partial(e+n&31,e+n>32?s:i.pop(),1)),i},_xor4:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},sjcl.codec.utf8String={fromBits:function(t){var e,s,i="",r=sjcl.bitArray.bitLength(t);for(e=0;e<r/8;e++)0==(3&e)&&(s=t[e/4]),i+=String.fromCharCode(s>>>24),s<<=8;return decodeURIComponent(escape(i))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,s=[],i=0;for(e=0;e<t.length;e++)i=i<<8|t.charCodeAt(e),3==(3&e)&&(s.push(i),i=0);return 3&e&&s.push(sjcl.bitArray.partial(8*(3&e),i)),s}},sjcl.codec.hex={fromBits:function(t){var e,s="";for(e=0;e<t.length;e++)s+=(0xf00000000000+(0|t[e])).toString(16).substr(4);return s.substr(0,sjcl.bitArray.bitLength(t)/4)},toBits:function(t){var e,s,i=[];for(t=t.replace(/\s|0x/g,""),s=t.length,t+="00000000",e=0;e<t.length;e+=8)i.push(0^parseInt(t.substr(e,8),16));return sjcl.bitArray.clamp(i,4*s)}},sjcl.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,s){var i,r="",n=0,c=sjcl.codec.base64._chars,o=0,l=sjcl.bitArray.bitLength(t);for(s&&(c=c.substr(0,62)+"-_"),i=0;6*r.length<l;)r+=c.charAt((o^t[i]>>>n)>>>26),n<6?(o=t[i]<<6-n,n+=26,i++):(o<<=6,n-=6);for(;3&r.length&&!e;)r+="=";return r},toBits:function(t,e){t=t.replace(/\s|=/g,"");var s,i,r=[],n=0,c=sjcl.codec.base64._chars,o=0;for(e&&(c=c.substr(0,62)+"-_"),s=0;s<t.length;s++){if(i=c.indexOf(t.charAt(s)),i<0)throw new sjcl.exception.invalid("this isn't base64!");n>26?(n-=26,r.push(o^i>>>n),o=i<<32-n):(n+=6,o^=i<<32-n)}return 56&n&&r.push(sjcl.bitArray.partial(56&n,o,1)),r}},sjcl.codec.base64url={fromBits:function(t){return sjcl.codec.base64.fromBits(t,1,1)},toBits:function(t){return sjcl.codec.base64.toBits(t,1)}},sjcl.codec.bytes={fromBits:function(t){var e,s,i=[],r=sjcl.bitArray.bitLength(t);for(e=0;e<r/8;e++)0==(3&e)&&(s=t[e/4]),i.push(s>>>24),s<<=8;return i},toBits:function(t){var e,s=[],i=0;for(e=0;e<t.length;e++)i=i<<8|t[e],3==(3&e)&&(s.push(i),i=0);return 3&e&&s.push(sjcl.bitArray.partial(8*(3&e),i)),s}},sjcl.hash.sha256=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},sjcl.hash.sha256.hash=function(t){return(new sjcl.hash.sha256).update(t).finalize()},sjcl.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t));var e,s=this._buffer=sjcl.bitArray.concat(this._buffer,t),i=this._length,r=this._length=i+sjcl.bitArray.bitLength(t);for(e=512+i&-512;e<=r;e+=512)this._block(s.splice(0,16));return this},finalize:function(){var t,e=this._buffer,s=this._h;for(e=sjcl.bitArray.concat(e,[sjcl.bitArray.partial(1,1)]),t=e.length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,16));return this.reset(),s},_init:[],_key:[],_precompute:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}var e,s=0,i=2;t:for(;s<64;i++){for(e=2;e*e<=i;e++)if(i%e==0)continue t;s<8&&(this._init[s]=t(Math.pow(i,.5))),this._key[s]=t(Math.pow(i,1/3)),s++}},_block:function(t){var e,s,i,r,n=t.slice(0),c=this._h,o=this._key,l=c[0],a=c[1],h=c[2],u=c[3],f=c[4],d=c[5],b=c[6],p=c[7];for(e=0;e<64;e++)e<16?s=n[e]:(i=n[e+1&15],r=n[e+14&15],s=n[15&e]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(r>>>17^r>>>19^r>>>10^r<<15^r<<13)+n[15&e]+n[e+9&15]|0),s=s+p+(f>>>6^f>>>11^f>>>25^f<<26^f<<21^f<<7)+(b^f&(d^b))+o[e],p=b,b=d,d=f,f=u+s|0,u=h,h=a,a=l,l=s+(a&h^u&(a^h))+(a>>>2^a>>>13^a>>>22^a<<30^a<<19^a<<10)|0;c[0]=c[0]+l|0,c[1]=c[1]+a|0,c[2]=c[2]+h|0,c[3]=c[3]+u|0,c[4]=c[4]+f|0,c[5]=c[5]+d|0,c[6]=c[6]+b|0,c[7]=c[7]+p|0}},sjcl.hash.sha512=function(t){this._key[0]||this._precompute(),t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},sjcl.hash.sha512.hash=function(t){return(new sjcl.hash.sha512).update(t).finalize()},sjcl.hash.sha512.prototype={blockSize:1024,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t));var e,s=this._buffer=sjcl.bitArray.concat(this._buffer,t),i=this._length,r=this._length=i+sjcl.bitArray.bitLength(t);for(e=1024+i&-1024;e<=r;e+=1024)this._block(s.splice(0,32));return this},finalize:function(){var t,e=this._buffer,s=this._h;for(e=sjcl.bitArray.concat(e,[sjcl.bitArray.partial(1,1)]),t=e.length+4;31&t;t++)e.push(0);for(e.push(0),e.push(0),e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,32));return this.reset(),s},_init:[],_initr:[12372232,13281083,9762859,1914609,15106769,4090911,4308331,8266105],_key:[],_keyr:[2666018,15689165,5061423,9034684,4764984,380953,1658779,7176472,197186,7368638,14987916,16757986,8096111,1480369,13046325,6891156,15813330,5187043,9229749,11312229,2818677,10937475,4324308,1135541,6741931,11809296,16458047,15666916,11046850,698149,229999,945776,13774844,2541862,12856045,9810911,11494366,7844520,15576806,8533307,15795044,4337665,16291729,5553712,15684120,6662416,7413802,12308920,13816008,4303699,9366425,10176680,13195875,4295371,6546291,11712675,15708924,1519456,15772530,6568428,6495784,8568297,13007125,7492395,2515356,12632583,14740254,7262584,1535930,13146278,16321966,1853211,294276,13051027,13221564,1051980,4080310,6651434,14088940,4675607],_precompute:function(){function t(t){return 4294967296*(t-Math.floor(t))|0}function e(t){return 1099511627776*(t-Math.floor(t))&255}var s,i=0,r=2;t:for(;i<80;r++){for(s=2;s*s<=r;s++)if(r%s==0)continue t;i<8&&(this._init[2*i]=t(Math.pow(r,.5)),this._init[2*i+1]=e(Math.pow(r,.5))<<24|this._initr[i]),this._key[2*i]=t(Math.pow(r,1/3)),this._key[2*i+1]=e(Math.pow(r,1/3))<<24|this._keyr[i],i++}},_block:function(t){var e,s,i,r=t.slice(0),n=this._h,c=this._key,o=n[0],l=n[1],a=n[2],h=n[3],u=n[4],f=n[5],d=n[6],b=n[7],p=n[8],m=n[9],_=n[10],g=n[11],j=n[12],v=n[13],y=n[14],w=n[15],E=o,x=l,B=a,A=h,M=u,D=f,k=d,S=b,F=p,R=m,C=_,q=g,L=j,z=v,I=y,O=w;for(e=0;e<80;e++){if(e<16)s=r[2*e],i=r[2*e+1];else{var P=r[2*(e-15)],G=r[2*(e-15)+1],N=(G<<31|P>>>1)^(G<<24|P>>>8)^P>>>7,K=(P<<31|G>>>1)^(P<<24|G>>>8)^(P<<25|G>>>7),U=r[2*(e-2)],J=r[2*(e-2)+1],T=(J<<13|U>>>19)^(U<<3|J>>>29)^U>>>6,V=(U<<13|J>>>19)^(J<<3|U>>>29)^(U<<26|J>>>6),Y=r[2*(e-7)],W=r[2*(e-7)+1],X=r[2*(e-16)],H=r[2*(e-16)+1];i=K+W,s=N+Y+(i>>>0<K>>>0?1:0),i+=V,s+=T+(i>>>0<V>>>0?1:0),i+=H,s+=X+(i>>>0<H>>>0?1:0)}r[2*e]=s|=0,r[2*e+1]=i|=0;var $=F&C^~F&L,Q=R&q^~R&z,Z=E&B^E&M^B&M,tt=x&A^x&D^A&D,et=(x<<4|E>>>28)^(E<<30|x>>>2)^(E<<25|x>>>7),st=(E<<4|x>>>28)^(x<<30|E>>>2)^(x<<25|E>>>7),it=(R<<18|F>>>14)^(R<<14|F>>>18)^(F<<23|R>>>9),rt=(F<<18|R>>>14)^(F<<14|R>>>18)^(R<<23|F>>>9),nt=c[2*e],ct=c[2*e+1],ot=O+rt,lt=I+it+(ot>>>0<O>>>0?1:0);ot+=Q,lt+=$+(ot>>>0<Q>>>0?1:0),ot+=ct,lt+=nt+(ot>>>0<ct>>>0?1:0),ot+=i,lt+=s+(ot>>>0<i>>>0?1:0);var at=st+tt,ht=et+Z+(at>>>0<st>>>0?1:0);I=L,O=z,L=C,z=q,C=F,q=R,R=S+ot|0,F=k+lt+(R>>>0<S>>>0?1:0)|0,k=M,S=D,M=B,D=A,B=E,A=x,x=ot+at|0,E=lt+ht+(x>>>0<ot>>>0?1:0)|0}l=n[1]=l+x|0,n[0]=o+E+(l>>>0<x>>>0?1:0)|0,h=n[3]=h+A|0,n[2]=a+B+(h>>>0<A>>>0?1:0)|0,f=n[5]=f+D|0,n[4]=u+M+(f>>>0<D>>>0?1:0)|0,b=n[7]=b+S|0,n[6]=d+k+(b>>>0<S>>>0?1:0)|0,m=n[9]=m+R|0,n[8]=p+F+(m>>>0<R>>>0?1:0)|0,g=n[11]=g+q|0,n[10]=_+C+(g>>>0<q>>>0?1:0)|0,v=n[13]=v+z|0,n[12]=j+L+(v>>>0<z>>>0?1:0)|0,w=n[15]=w+O|0,n[14]=y+I+(w>>>0<O>>>0?1:0)|0}},sjcl.hash.sha1=function(t){t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},sjcl.hash.sha1.hash=function(t){return(new sjcl.hash.sha1).update(t).finalize()},sjcl.hash.sha1.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t));var e,s=this._buffer=sjcl.bitArray.concat(this._buffer,t),i=this._length,r=this._length=i+sjcl.bitArray.bitLength(t);for(e=this.blockSize+i&-this.blockSize;e<=r;e+=this.blockSize)this._block(s.splice(0,16));return this},finalize:function(){var t,e=this._buffer,s=this._h;for(e=sjcl.bitArray.concat(e,[sjcl.bitArray.partial(1,1)]),t=e.length+2;15&t;t++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(0|this._length);e.length;)this._block(e.splice(0,16));return this.reset(),s},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(t,e,s,i){return t<=19?e&s|~e&i:t<=39?e^s^i:t<=59?e&s|e&i|s&i:t<=79?e^s^i:void 0},_S:function(t,e){return e<<t|e>>>32-t},_block:function(t){var e,s,i,r,n,c,o,l=t.slice(0),a=this._h;this._key;for(i=a[0],r=a[1],n=a[2],c=a[3],o=a[4],e=0;e<=79;e++)e>=16&&(l[e]=this._S(1,l[e-3]^l[e-8]^l[e-14]^l[e-16])),s=this._S(5,i)+this._f(e,r,n,c)+o+l[e]+this._key[Math.floor(e/20)]|0,o=c,c=n,n=this._S(30,r),r=i,i=s;a[0]=a[0]+i|0,a[1]=a[1]+r|0,a[2]=a[2]+n|0,a[3]=a[3]+c|0,a[4]=a[4]+o|0}},sjcl.mode.ccm={name:"ccm",encrypt:function(t,e,s,i,r){var n,c,o=e.slice(0),l=sjcl.bitArray,a=l.bitLength(s)/8,h=l.bitLength(o)/8;if(r=r||64,i=i||[],a<7)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(n=2;n<4&&h>>>8*n;n++);return n<15-a&&(n=15-a),s=l.clamp(s,8*(15-n)),c=sjcl.mode.ccm._computeTag(t,e,s,i,r,n),o=sjcl.mode.ccm._ctrMode(t,o,s,c,r,n),l.concat(o.data,o.tag)},decrypt:function(t,e,s,i,r){r=r||64,i=i||[];var n,c,o=sjcl.bitArray,l=o.bitLength(s)/8,a=o.bitLength(e),h=o.clamp(e,a-r),u=o.bitSlice(e,a-r);if(a=(a-r)/8,l<7)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(n=2;n<4&&a>>>8*n;n++);if(n<15-l&&(n=15-l),s=o.clamp(s,8*(15-n)),h=sjcl.mode.ccm._ctrMode(t,h,s,u,r,n),c=sjcl.mode.ccm._computeTag(t,h.data,s,i,r,n),!o.equal(h.tag,c))throw new sjcl.exception.corrupt("ccm: tag doesn't match");return h.data},_computeTag:function(t,e,s,i,r,n){var c,o,l,a=[],h=sjcl.bitArray,u=h._xor4;if(r/=8,r%2||r<4||r>16)throw new sjcl.exception.invalid("ccm: invalid tag length");if(i.length>4294967295||e.length>4294967295)throw new sjcl.exception.bug("ccm: can't deal with 4GiB or more data");if(c=[h.partial(8,(i.length?64:0)|r-2<<2|n-1)],c=h.concat(c,s),c[3]|=h.bitLength(e)/8,c=t.encrypt(c),i.length)for(o=h.bitLength(i)/8,o<=65279?a=[h.partial(16,o)]:o<=4294967295&&(a=h.concat([h.partial(16,65534)],[o])),a=h.concat(a,i),l=0;l<a.length;l+=4)c=t.encrypt(u(c,a.slice(l,l+4).concat([0,0,0])));for(l=0;l<e.length;l+=4)c=t.encrypt(u(c,e.slice(l,l+4).concat([0,0,0])));return h.clamp(c,8*r)},_ctrMode:function(t,e,s,i,r,n){var c,o,l,a=sjcl.bitArray,h=a._xor4,u=e.length,f=a.bitLength(e);if(l=a.concat([a.partial(8,n-1)],s).concat([0,0,0]).slice(0,4),i=a.bitSlice(h(i,t.encrypt(l)),0,r),!u)return{tag:i,data:[]};for(o=0;o<u;o+=4)l[3]++,c=t.encrypt(l),e[o]^=c[0],e[o+1]^=c[1],e[o+2]^=c[2],e[o+3]^=c[3];return{tag:i,data:a.clamp(e,f)}}},sjcl.misc.hmac=function(t,e){this._hash=e=e||sjcl.hash.sha256;var s,i=[[],[]],r=e.prototype.blockSize/32;for(this._baseHash=[new e,new e],t.length>r&&(t=e.hash(t)),s=0;s<r;s++)i[0][s]=909522486^t[s],i[1][s]=1549556828^t[s];this._baseHash[0].update(i[0]),this._baseHash[1].update(i[1])},sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(t){var e=new this._hash(this._baseHash[0]).update(t).finalize();return new this._hash(this._baseHash[1]).update(e).finalize()},sjcl.misc.pbkdf2=function(t,e,s,i,r){if(s=s||1e3,i<0||s<0)throw sjcl.exception.invalid("invalid params to pbkdf2");"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t)),r=r||sjcl.misc.hmac;var n,c,o,l,a,h=new r(t),u=[],f=sjcl.bitArray;for(a=1;32*u.length<(i||1);a++){for(n=c=h.encrypt(f.concat(e,[a])),o=1;o<s;o++)for(c=h.encrypt(c),l=0;l<c.length;l++)n[l]^=c[l];u=u.concat(n)}return i&&(u=f.clamp(u,i)),u},sjcl.prng=function(t){this._pools=[new sjcl.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=t,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80},sjcl.prng.prototype={randomWords:function(t,e){var s,i,r=[],n=this.isReady(e);if(n===this._NOT_READY)throw new sjcl.exception.notReady("generator isn't seeded");for(n&this._REQUIRES_RESEED&&this._reseedFromPools(!(n&this._READY)),s=0;s<t;s+=4)(s+1)%this._MAX_WORDS_PER_BURST==0&&this._gate(),i=this._gen4words(),r.push(i[0],i[1],i[2],i[3]);return this._gate(),r.slice(0,t)},setDefaultParanoia:function(t){this._defaultParanoia=t},addEntropy:function(t,e,s){s=s||"user";var i,r,n,c=(new Date).valueOf(),o=this._robins[s],l=this.isReady(),a=0;switch(i=this._collectorIds[s],void 0===i&&(i=this._collectorIds[s]=this._collectorIdNext++),void 0===o&&(o=this._robins[s]=0),this._robins[s]=(this._robins[s]+1)%this._pools.length,typeof t){case"number":void 0===e&&(e=1),this._pools[o].update([i,this._eventId++,1,e,c,1,0|t]);break;case"object":var h=Object.prototype.toString.call(t);if("[object Uint32Array]"===h){for(n=[],r=0;r<t.length;r++)n.push(t[r]);t=n}else for("[object Array]"!==h&&(a=1),r=0;r<t.length&&!a;r++)"number"!=typeof t[r]&&(a=1);if(!a){if(void 0===e)for(e=0,r=0;r<t.length;r++)for(n=t[r];n>0;)e++,n>>>=1;this._pools[o].update([i,this._eventId++,2,e,c,t.length].concat(t))}break;case"string":void 0===e&&(e=t.length),this._pools[o].update([i,this._eventId++,3,e,c,t.length]),this._pools[o].update(t);break;default:a=1}if(a)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[o]+=e,this._poolStrength+=e,l===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(t){var e=this._PARANOIA_LEVELS[void 0!==t?t:this._defaultParanoia];return this._strength&&this._strength>=e?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=e?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(t){var e=this._PARANOIA_LEVELS[t||this._defaultParanoia];return this._strength>=e?1:this._poolStrength>e?1:this._poolStrength/e},startCollectors:function(){if(!this._collectorsStarted){if(window.addEventListener)window.addEventListener("load",this._loadTimeCollector,!1),window.addEventListener("mousemove",this._mouseCollector,!1);else{if(!document.attachEvent)throw new sjcl.exception.bug("can't attach event");document.attachEvent("onload",this._loadTimeCollector),document.attachEvent("onmousemove",this._mouseCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._loadTimeCollector,!1),window.removeEventListener("mousemove",this._mouseCollector,!1)):window.detachEvent&&(window.detachEvent("onload",this._loadTimeCollector),window.detachEvent("onmousemove",this._mouseCollector)),this._collectorsStarted=!1)},addEventListener:function(t,e){this._callbacks[t][this._callbackI++]=e},removeEventListener:function(t,e){var s,i,r=this._callbacks[t],n=[];for(i in r)r.hasOwnProperty(i)&&r[i]===e&&n.push(i);for(s=0;s<n.length;s++)i=n[s],delete r[i]},_gen4words:function(){for(var t=0;t<4&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new sjcl.cipher.aes(this._key)},_reseed:function(t){this._key=sjcl.hash.sha256.hash(this._key.concat(t)),this._cipher=new sjcl.cipher.aes(this._key);for(var e=0;e<4&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);},_reseedFromPools:function(t){var e,s=[],i=0;for(this._nextReseed=s[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,e=0;e<16;e++)s.push(4294967296*Math.random()|0);for(e=0;e<this._pools.length&&(s=s.concat(this._pools[e].finalize()),i+=this._poolEntropy[e],this._poolEntropy[e]=0,t||!(this._reseedCount&1<<e));e++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new sjcl.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=i,i>this._strength&&(this._strength=i),this._reseedCount++,this._reseed(s)},_mouseCollector:function(t){var e=t.x||t.clientX||t.offsetX||0,s=t.y||t.clientY||t.offsetY||0;sjcl.random.addEntropy([e,s],2,"mouse")},_loadTimeCollector:function(t){sjcl.random.addEntropy((new Date).valueOf(),2,"loadtime")},_fireEvent:function(t,e){var s,i=sjcl.random._callbacks[t],r=[];for(s in i)i.hasOwnProperty(s)&&r.push(i[s]);for(s=0;s<r.length;s++)r[s](e)}},sjcl.random=new sjcl.prng(6),function(){try{var t=new Uint32Array(32);crypto.getRandomValues(t),sjcl.random.addEntropy(t,1024,"crypto.getRandomValues")}catch(t){}}(),sjcl.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(t,e,s,i){s=s||{},i=i||{};var r,n,c,o=sjcl.json,l=o._add({iv:sjcl.random.randomWords(4,0)},o.defaults);if(o._add(l,s),c=l.adata,"string"==typeof l.salt&&(l.salt=sjcl.codec.base64.toBits(l.salt)),"string"==typeof l.iv&&(l.iv=sjcl.codec.base64.toBits(l.iv)),!sjcl.mode[l.mode]||!sjcl.cipher[l.cipher]||"string"==typeof t&&l.iter<=100||64!==l.ts&&96!==l.ts&&128!==l.ts||128!==l.ks&&192!==l.ks&&256!==l.ks||l.iv.length<2||l.iv.length>4)throw new sjcl.exception.invalid("json encrypt: invalid parameters");return"string"==typeof t?(r=sjcl.misc.cachedPbkdf2(t,l),t=r.key.slice(0,l.ks/32),l.salt=r.salt):sjcl.ecc&&t instanceof sjcl.ecc.elGamal.publicKey&&(r=t.kem(),l.kemtag=r.tag,t=r.key.slice(0,l.ks/32)),"string"==typeof e&&(e=sjcl.codec.utf8String.toBits(e)),"string"==typeof c&&(c=sjcl.codec.utf8String.toBits(c)),n=new sjcl.cipher[l.cipher](t),o._add(i,l),i.key=t,l.ct=sjcl.mode[l.mode].encrypt(n,e,l.iv,c,l.ts),o.encode(l)},decrypt:function(t,e,s,i){s=s||{},i=i||{};var r,n,c,o=sjcl.json,l=o._add(o._add(o._add({},o.defaults),o.decode(e)),s,!0),a=l.adata;if("string"==typeof l.salt&&(l.salt=sjcl.codec.base64.toBits(l.salt)),"string"==typeof l.iv&&(l.iv=sjcl.codec.base64.toBits(l.iv)),!sjcl.mode[l.mode]||!sjcl.cipher[l.cipher]||"string"==typeof t&&l.iter<=100||64!==l.ts&&96!==l.ts&&128!==l.ts||128!==l.ks&&192!==l.ks&&256!==l.ks||!l.iv||l.iv.length<2||l.iv.length>4)throw new sjcl.exception.invalid("json decrypt: invalid parameters");return"string"==typeof t?(n=sjcl.misc.cachedPbkdf2(t,l),t=n.key.slice(0,l.ks/32),l.salt=n.salt):sjcl.ecc&&t instanceof sjcl.ecc.elGamal.secretKey&&(t=t.unkem(sjcl.codec.base64.toBits(l.kemtag)).slice(0,l.ks/32)),"string"==typeof a&&(a=sjcl.codec.utf8String.toBits(a)),c=new sjcl.cipher[l.cipher](t),r=sjcl.mode[l.mode].decrypt(c,l.ct,l.iv,a,l.ts),o._add(i,l),i.key=t,sjcl.codec.utf8String.fromBits(r)},encode:function(t){var e,s="{",i="";for(e in t)if(t.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");switch(s+=i+'"'+e+'":',i=",",typeof t[e]){case"number":case"boolean":s+=t[e];break;case"string":s+='"'+escape(t[e])+'"';break;case"object":s+='"'+sjcl.codec.base64.fromBits(t[e],0)+'"';break;default:throw new sjcl.exception.bug("json encode: unsupported type")}}return s+"}"},decode:function(t){if(t=t.replace(/\s/g,""),!t.match(/^\{.*\}$/))throw new sjcl.exception.invalid("json decode: this isn't json!");var e,s,i=t.replace(/^\{|\}$/g,"").split(/,/),r={};for(e=0;e<i.length;e++){if(!(s=i[e].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new sjcl.exception.invalid("json decode: this isn't json!");s[3]?r[s[2]]=parseInt(s[3],10):r[s[2]]=s[2].match(/^(ct|salt|iv)$/)?sjcl.codec.base64.toBits(s[4]):unescape(s[4])}return r},_add:function(t,e,s){if(void 0===t&&(t={}),void 0===e)return t;var i;for(i in e)if(e.hasOwnProperty(i)){if(s&&void 0!==t[i]&&t[i]!==e[i])throw new sjcl.exception.invalid("required parameter overridden");t[i]=e[i]}return t},_subtract:function(t,e){var s,i={};for(s in t)t.hasOwnProperty(s)&&t[s]!==e[s]&&(i[s]=t[s]);return i},_filter:function(t,e){var s,i={};for(s=0;s<e.length;s++)void 0!==t[e[s]]&&(i[e[s]]=t[e[s]]);return i}},sjcl.encrypt=sjcl.json.encrypt,sjcl.decrypt=sjcl.json.decrypt,sjcl.misc._pbkdf2Cache={},sjcl.misc.cachedPbkdf2=function(t,e){var s,i,r,n,c=sjcl.misc._pbkdf2Cache;return e=e||{},n=e.iter||1e3,i=c[t]=c[t]||{},s=i[n]=i[n]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):sjcl.random.randomWords(2,0)},r=void 0===e.salt?s.firstSalt:e.salt,s[r]=s[r]||sjcl.misc.pbkdf2(t,r,e.iter),{key:s[r].slice(0),salt:r.slice(0)}},sjcl.bn=function(t){this.initWith(t)},sjcl.bn.prototype={radix:24,maxMul:8,_class:sjcl.bn,copy:function(){return new this._class(this)},initWith:function(t){var e,s=0;switch(typeof t){case"object":this.limbs=t.limbs.slice(0);break;case"number":this.limbs=[t],this.normalize();break;case"string":for(t=t.replace(/^0x/,""),this.limbs=[],e=this.radix/4,s=0;s<t.length;s+=e)this.limbs.push(parseInt(t.substring(Math.max(t.length-s-e,0),t.length-s),16));break;default:this.limbs=[0]}return this},equals:function(t){"number"==typeof t&&(t=new this._class(t));var e,s=0;for(this.fullReduce(),t.fullReduce(),e=0;e<this.limbs.length||e<t.limbs.length;e++)s|=this.getLimb(e)^t.getLimb(e);return 0===s},getLimb:function(t){return t>=this.limbs.length?0:this.limbs[t]},greaterEquals:function(t){"number"==typeof t&&(t=new this._class(t));var e,s,i,r=0,n=0;for(e=Math.max(this.limbs.length,t.limbs.length)-1;e>=0;e--)s=this.getLimb(e),i=t.getLimb(e),n|=i-s&~r,r|=s-i&~n;return(n|~r)>>>31},toString:function(){this.fullReduce();var t,e,s="",i=this.limbs;for(t=0;t<this.limbs.length;t++){for(e=i[t].toString(16);t<this.limbs.length-1&&e.length<6;)e="0"+e;s=e+s}return"0x"+s},addM:function(t){"object"!=typeof t&&(t=new this._class(t));var e,s=this.limbs,i=t.limbs;for(e=s.length;e<i.length;e++)s[e]=0;for(e=0;e<i.length;e++)s[e]+=i[e];return this},doubleM:function(){var t,e,s=0,i=this.radix,r=this.radixMask,n=this.limbs;for(t=0;t<n.length;t++)e=n[t],e=e+e+s,n[t]=e&r,s=e>>i;return s&&n.push(s),this},halveM:function(){var t,e,s=0,i=this.radix,r=this.limbs;for(t=r.length-1;t>=0;t--)e=r[t],r[t]=e+s>>1,s=(1&e)<<i;return r[r.length-1]||r.pop(),this},subM:function(t){"object"!=typeof t&&(t=new this._class(t));var e,s=this.limbs,i=t.limbs;for(e=s.length;e<i.length;e++)s[e]=0;for(e=0;e<i.length;e++)s[e]-=i[e];return this},mod:function(t){var e=!this.greaterEquals(new sjcl.bn(0));t=new sjcl.bn(t).normalize();var s=new sjcl.bn(this).normalize(),i=0;for(e&&(s=new sjcl.bn(0).subM(s).normalize());s.greaterEquals(t);i++)t.doubleM();for(e&&(s=t.sub(s).normalize());i>0;i--)t.halveM(),s.greaterEquals(t)&&s.subM(t).normalize();return s.trim()},inverseMod:function(t){var e,s,i=new sjcl.bn(1),r=new sjcl.bn(0),n=new sjcl.bn(this),c=new sjcl.bn(t),o=1;if(!(1&t.limbs[0]))throw new sjcl.exception.invalid("inverseMod: p must be odd");do{for(1&n.limbs[0]&&(n.greaterEquals(c)||(e=n,n=c,c=e,e=i,i=r,r=e),n.subM(c),n.normalize(),i.greaterEquals(r)||i.addM(t),i.subM(r)),n.halveM(),1&i.limbs[0]&&i.addM(t),i.normalize(),i.halveM(),s=o=0;s<n.limbs.length;s++)o|=n.limbs[s]}while(o);if(!c.equals(1))throw new sjcl.exception.invalid("inverseMod: p and x must be relatively prime");return r},add:function(t){return this.copy().addM(t)},sub:function(t){return this.copy().subM(t)},mul:function(t){"number"==typeof t&&(t=new this._class(t));var e,s,i,r=this.limbs,n=t.limbs,c=r.length,o=n.length,l=new this._class,a=l.limbs,h=this.maxMul;for(e=0;e<this.limbs.length+t.limbs.length+1;e++)a[e]=0;for(e=0;e<c;e++){for(i=r[e],s=0;s<o;s++)a[e+s]+=i*n[s];--h||(h=this.maxMul,l.cnormalize())}return l.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(t){"number"==typeof t?t=[t]:void 0!==t.limbs&&(t=t.normalize().limbs);var e,s,i=new this._class(1),r=this;for(e=0;e<t.length;e++)for(s=0;s<this.radix;s++)t[e]&1<<s&&(i=i.mul(r)),r=r.square();return i},mulmod:function(t,e){return this.mod(e).mul(t.mod(e)).mod(e)},powermod:function(t,e){for(var s=new sjcl.bn(1),i=new sjcl.bn(this),r=new sjcl.bn(t);1&r.limbs[0]&&(s=s.mulmod(i,e)),r.halveM(),!r.equals(0);)i=i.mulmod(i,e);return s.normalize().reduce()},trim:function(){var t,e=this.limbs;do{t=e.pop()}while(e.length&&0===t);return e.push(t),this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var t,e,s,i=0,r=(this.placeVal,this.ipv),n=this.limbs,c=n.length,o=this.radixMask;for(t=0;t<c||0!==i&&-1!==i;t++)e=(n[t]||0)+i,s=n[t]=e&o,i=(e-s)*r;return-1===i&&(n[t-1]-=this.placeVal),this},cnormalize:function(){var t,e,s,i=0,r=this.ipv,n=this.limbs,c=n.length,o=this.radixMask;for(t=0;t<c-1;t++)e=n[t]+i,s=n[t]=e&o,i=(e-s)*r;return n[t]+=i,this},toBits:function(t){this.fullReduce(),t=t||this.exponent||this.bitLength();var e=Math.floor((t-1)/24),s=sjcl.bitArray,i=(t+7&-8)%this.radix||this.radix,r=[s.partial(i,this.getLimb(e))];for(e--;e>=0;e--)r=s.concat(r,[s.partial(Math.min(this.radix,t),this.getLimb(e))]),t-=this.radix;return r},bitLength:function(){this.fullReduce();for(var t=this.radix*(this.limbs.length-1),e=this.limbs[this.limbs.length-1];e;e>>>=1)t++;return t+7&-8}},sjcl.bn.fromBits=function(t){var e=this,s=new e,i=[],r=sjcl.bitArray,n=this.prototype,c=Math.min(this.bitLength||4294967296,r.bitLength(t)),o=c%n.radix||n.radix;for(i[0]=r.extract(t,0,o);o<c;o+=n.radix)i.unshift(r.extract(t,o,n.radix));return s.limbs=i,s},sjcl.bn.prototype.ipv=1/(sjcl.bn.prototype.placeVal=Math.pow(2,sjcl.bn.prototype.radix)),sjcl.bn.prototype.radixMask=(1<<sjcl.bn.prototype.radix)-1,sjcl.bn.pseudoMersennePrime=function(t,e){function s(t){this.initWith(t)}var i,r,n,c=s.prototype=new sjcl.bn;for(n=c.modOffset=Math.ceil(r=t/c.radix),c.exponent=t,c.offset=[],c.factor=[],c.minOffset=n,c.fullMask=0,c.fullOffset=[],c.fullFactor=[],c.modulus=s.modulus=new sjcl.bn(Math.pow(2,t)),c.fullMask=0|-Math.pow(2,t%c.radix),i=0;i<e.length;i++)c.offset[i]=Math.floor(e[i][0]/c.radix-r),c.fullOffset[i]=Math.ceil(e[i][0]/c.radix-r),c.factor[i]=e[i][1]*Math.pow(.5,t-e[i][0]+c.offset[i]*c.radix),c.fullFactor[i]=e[i][1]*Math.pow(.5,t-e[i][0]+c.fullOffset[i]*c.radix),c.modulus.addM(new sjcl.bn(Math.pow(2,e[i][0])*e[i][1])),c.minOffset=Math.min(c.minOffset,-c.offset[i]);return c._class=s,c.modulus.cnormalize(),c.reduce=function(){var t,e,s,i,r=this.modOffset,n=this.limbs,c=this.offset,o=this.offset.length,l=this.factor;for(t=this.minOffset;n.length>r;){for(s=n.pop(),i=n.length,e=0;e<o;e++)n[i+c[e]]-=l[e]*s;t--,t||(n.push(0),this.cnormalize(),
t=this.minOffset)}return this.cnormalize(),this},c._strongReduce=-1===c.fullMask?c.reduce:function(){var t,e,s=this.limbs,i=s.length-1;if(this.reduce(),i===this.modOffset-1){for(e=s[i]&this.fullMask,s[i]-=e,t=0;t<this.fullOffset.length;t++)s[i+this.fullOffset[t]]-=this.fullFactor[t]*e;this.normalize()}},c.fullReduce=function(){var t,e;for(this._strongReduce(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this._strongReduce(),e=this.limbs.length;e<this.modOffset;e++)this.limbs[e]=0;for(t=this.greaterEquals(this.modulus),e=0;e<this.limbs.length;e++)this.limbs[e]-=this.modulus.limbs[e]*t;return this.cnormalize(),this},c.inverse=function(){return this.power(this.modulus.sub(2))},s.fromBits=sjcl.bn.fromBits,s},sjcl.bn.prime={p127:sjcl.bn.pseudoMersennePrime(127,[[0,-1]]),p25519:sjcl.bn.pseudoMersennePrime(255,[[0,-19]]),p192:sjcl.bn.pseudoMersennePrime(192,[[0,-1],[64,-1]]),p224:sjcl.bn.pseudoMersennePrime(224,[[0,1],[96,-1]]),p256:sjcl.bn.pseudoMersennePrime(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:sjcl.bn.pseudoMersennePrime(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:sjcl.bn.pseudoMersennePrime(521,[[0,-1]])},sjcl.bn.random=function(t,e){"object"!=typeof t&&(t=new sjcl.bn(t));for(var s,i,r=t.limbs.length,n=t.limbs[r-1]+1,c=new sjcl.bn;;){do{s=sjcl.random.randomWords(r,e),s[r-1]<0&&(s[r-1]+=4294967296)}while(Math.floor(s[r-1]/n)===Math.floor(4294967296/n));for(s[r-1]%=n,i=0;i<r-1;i++)s[i]&=t.radixMask;if(c.limbs=s,!c.greaterEquals(t))return c}},sjcl.ecc={},sjcl.ecc.point=function(t,e,s){void 0===e?this.isIdentity=!0:(e instanceof sjcl.bn&&(e=new t.field(e)),s instanceof sjcl.bn&&(s=new t.field(s)),this.x=e,this.y=s,this.isIdentity=!1),this.curve=t},sjcl.ecc.point.prototype={toJac:function(){return new sjcl.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},mult:function(t){return this.toJac().mult(t,this).toAffine()},mult2:function(t,e,s){return this.toJac().mult2(t,this,e,s).toAffine()},multiples:function(){var t,e,s;if(void 0===this._multiples)for(s=this.toJac().doubl(),t=this._multiples=[new sjcl.ecc.point(this.curve),this,s.toAffine()],e=3;e<16;e++)s=s.add(this),t.push(s.toAffine());return this._multiples},isValid:function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},toBits:function(){return sjcl.bitArray.concat(this.x.toBits(),this.y.toBits())}},sjcl.ecc.pointJac=function(t,e,s,i){void 0===e?this.isIdentity=!0:(this.x=e,this.y=s,this.z=i,this.isIdentity=!1),this.curve=t},sjcl.ecc.pointJac.prototype={add:function(t){var e,s,i,r,n,c,o,l,a,h,u,f=this;if(f.curve!==t.curve)throw"sjcl.ecc.add(): Points must be on the same curve to add them!";return f.isIdentity?t.toJac():t.isIdentity?f:(e=f.z.square(),s=t.x.mul(e).subM(f.x),s.equals(0)?f.y.equals(t.y.mul(e.mul(f.z)))?f.doubl():new sjcl.ecc.pointJac(f.curve):(i=t.y.mul(e.mul(f.z)).subM(f.y),r=s.square(),n=i.square(),c=s.square().mul(s).addM(f.x.add(f.x).mul(r)),o=n.subM(c),l=f.x.mul(r).subM(o).mul(i),a=f.y.mul(s.square().mul(s)),h=l.subM(a),u=f.z.mul(s),new sjcl.ecc.pointJac(this.curve,o,h,u)))},doubl:function(){if(this.isIdentity)return this;var t=this.y.square(),e=t.mul(this.x.mul(4)),s=t.square().mul(8),i=this.z.square(),r=this.x.sub(i).mul(3).mul(this.x.add(i)),n=r.square().subM(e).subM(e),c=e.sub(n).mul(r).subM(s),o=this.y.add(this.y).mul(this.z);return new sjcl.ecc.pointJac(this.curve,n,c,o)},toAffine:function(){if(this.isIdentity||this.z.equals(0))return new sjcl.ecc.point(this.curve);var t=this.z.inverse(),e=t.square();return new sjcl.ecc.point(this.curve,this.x.mul(e).fullReduce(),this.y.mul(e.mul(t)).fullReduce())},mult:function(t,e){"number"==typeof t?t=[t]:void 0!==t.limbs&&(t=t.normalize().limbs);var s,i,r=new sjcl.ecc.point(this.curve).toJac(),n=e.multiples();for(s=t.length-1;s>=0;s--)for(i=sjcl.bn.prototype.radix-4;i>=0;i-=4)r=r.doubl().doubl().doubl().doubl().add(n[t[s]>>i&15]);return r},mult2:function(t,e,s,i){"number"==typeof t?t=[t]:void 0!==t.limbs&&(t=t.normalize().limbs),"number"==typeof s?s=[s]:void 0!==s.limbs&&(s=s.normalize().limbs);var r,n,c,o,l=new sjcl.ecc.point(this.curve).toJac(),a=e.multiples(),h=i.multiples();for(r=Math.max(t.length,s.length)-1;r>=0;r--)for(c=0|t[r],o=0|s[r],n=sjcl.bn.prototype.radix-4;n>=0;n-=4)l=l.doubl().doubl().doubl().doubl().add(a[c>>n&15]).add(h[o>>n&15]);return l},isValid:function(){var t=this.z.square(),e=t.square(),s=e.mul(t);return this.y.square().equals(this.curve.b.mul(s).add(this.x.mul(this.curve.a.mul(e).add(this.x.square()))))}},sjcl.ecc.curve=function(t,e,s,i,r,n){this.field=t,this.r=t.prototype.modulus.sub(e),this.a=new t(s),this.b=new t(i),this.G=new sjcl.ecc.point(this,new t(r),new t(n))},sjcl.ecc.curve.prototype.fromBits=function(t){var e=sjcl.bitArray,s=this.field.prototype.exponent+7&-8,i=new sjcl.ecc.point(this,this.field.fromBits(e.bitSlice(t,0,s)),this.field.fromBits(e.bitSlice(t,s,2*s)));if(!i.isValid())throw new sjcl.exception.corrupt("not on the curve!");return i},sjcl.ecc.curves={c192:new sjcl.ecc.curve(sjcl.bn.prime.p192,"0x662107c8eb94364e4b2dd7ce",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new sjcl.ecc.curve(sjcl.bn.prime.p224,"0xe95c1f470fc1ec22d6baa3a3d5c4",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new sjcl.ecc.curve(sjcl.bn.prime.p256,"0x4319055358e8617b0c46353d039cdaae",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new sjcl.ecc.curve(sjcl.bn.prime.p384,"0x389cb27e0bc8d21fa7e5f24cb74f58851313e696333ad68c",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},sjcl.ecc._dh=function(t){sjcl.ecc[t]={publicKey:function(t,e){this._curve=t,this._curveBitLength=t.r.bitLength(),e instanceof Array?this._point=t.fromBits(e):this._point=e,this.get=function(){var t=this._point.toBits(),e=sjcl.bitArray.bitLength(t),s=sjcl.bitArray.bitSlice(t,0,e/2),i=sjcl.bitArray.bitSlice(t,e/2);return{x:s,y:i}}},secretKey:function(t,e){this._curve=t,this._curveBitLength=t.r.bitLength(),this._exponent=e,this.get=function(){return this._exponent.toBits()}},generateKeys:function(e,s,i){if(void 0===e&&(e=256),"number"==typeof e&&(e=sjcl.ecc.curves["c"+e],void 0===e))throw new sjcl.exception.invalid("no such curve");if(void 0===i)i=sjcl.bn.random(e.r,s);var r=e.G.mult(i);return{pub:new sjcl.ecc[t].publicKey(e,r),sec:new sjcl.ecc[t].secretKey(e,i)}}}},sjcl.ecc._dh("elGamal"),sjcl.ecc.elGamal.publicKey.prototype={kem:function(t){var e=sjcl.bn.random(this._curve.r,t),s=this._curve.G.mult(e).toBits(),i=sjcl.hash.sha256.hash(this._point.mult(e).toBits());return{key:i,tag:s}}},sjcl.ecc.elGamal.secretKey.prototype={unkem:function(t){return sjcl.hash.sha256.hash(this._curve.fromBits(t).mult(this._exponent).toBits())},dh:function(t){return sjcl.hash.sha256.hash(t._point.mult(this._exponent).toBits())}},sjcl.ecc._dh("ecdsa"),sjcl.ecc.ecdsa.secretKey.prototype={sign:function(t,e,s,i){sjcl.bitArray.bitLength(t)>this._curveBitLength&&(t=sjcl.bitArray.clamp(t,this._curveBitLength));var r=this._curve.r,n=r.bitLength(),c=i||sjcl.bn.random(r.sub(1),e).add(1),o=this._curve.G.mult(c).x.mod(r),l=sjcl.bn.fromBits(t).add(o.mul(this._exponent)),a=s?l.inverseMod(r).mul(c).mod(r):l.mul(c.inverseMod(r)).mod(r);return sjcl.bitArray.concat(o.toBits(n),a.toBits(n))}},sjcl.ecc.ecdsa.publicKey.prototype={verify:function(t,e,s){sjcl.bitArray.bitLength(t)>this._curveBitLength&&(t=sjcl.bitArray.clamp(t,this._curveBitLength));var i=sjcl.bitArray,r=this._curve.r,n=this._curveBitLength,c=sjcl.bn.fromBits(i.bitSlice(e,0,n)),o=sjcl.bn.fromBits(i.bitSlice(e,n,2*n)),l=s?o:o.inverseMod(r),a=sjcl.bn.fromBits(t).mul(l).mod(r),h=c.mul(l).mod(r),u=this._curve.G.mult2(a,h,this._point).x;if(c.equals(0)||o.equals(0)||c.greaterEquals(r)||o.greaterEquals(r)||!u.equals(c)){if(void 0===s)return this.verify(t,e,!0);throw new sjcl.exception.corrupt("signature didn't check out")}return!0}},sjcl.keyexchange.srp={makeVerifier:function(t,e,s,i){var r;return r=sjcl.keyexchange.srp.makeX(t,e,s),r=sjcl.bn.fromBits(r),i.g.powermod(r,i.N)},makeX:function(t,e,s){var i=sjcl.hash.sha1.hash(t+":"+e);return sjcl.hash.sha1.hash(sjcl.bitArray.concat(s,i))},knownGroup:function(t){return"string"!=typeof t&&(t=t.toString()),sjcl.keyexchange.srp._didInitKnownGroups||sjcl.keyexchange.srp._initKnownGroups(),sjcl.keyexchange.srp._knownGroups[t]},_didInitKnownGroups:!1,_initKnownGroups:function(){var t,e,s;for(t=0;t<sjcl.keyexchange.srp._knownGroupSizes.length;t++)e=sjcl.keyexchange.srp._knownGroupSizes[t].toString(),s=sjcl.keyexchange.srp._knownGroups[e],s.N=new sjcl.bn(s.N),s.g=new sjcl.bn(s.g);sjcl.keyexchange.srp._didInitKnownGroups=!0},_knownGroupSizes:[1024,1536,2048],_knownGroups:{1024:{N:"EEAF0AB9ADB38DD69C33F80AFA8FC5E86072618775FF3C0B9EA2314C9C256576D674DF7496EA81D3383B4813D692C6E0E0D5D8E250B98BE48E495C1D6089DAD15DC7D7B46154D6B6CE8EF4AD69B15D4982559B297BCF1885C529F566660E57EC68EDBC3C05726CC02FD4CBF4976EAA9AFD5138FE8376435B9FC61D2FC0EB06E3",g:2},1536:{N:"9DEF3CAFB939277AB1F12A8617A47BBBDBA51DF499AC4C80BEEEA9614B19CC4D5F4F5F556E27CBDE51C6A94BE4607A291558903BA0D0F84380B655BB9A22E8DCDF028A7CEC67F0D08134B1C8B97989149B609E0BE3BAB63D47548381DBC5B1FC764E3F4B53DD9DA1158BFD3E2B9C8CF56EDF019539349627DB2FD53D24B7C48665772E437D6C7F8CE442734AF7CCB7AE837C264AE3A9BEB87F8A2FE9B8B5292E5A021FFF5E91479E8CE7A28C2442C6F315180F93499A234DCF76E3FED135F9BB",g:2},2048:{N:"AC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF73",g:2}}},sjcl.ecc.point.prototype.isValidPoint=function(){var t=this,e=t.curve.field.modulus;return!t.isIdentity&&(!(new sjcl.bn(1).greaterEquals(t.x)&&!t.x.equals(1)||t.x.greaterEquals(e.sub(1))&&!t.x.equals(1))&&(!(new sjcl.bn(1).greaterEquals(t.y)&&!t.y.equals(1)||t.y.greaterEquals(e.sub(1))&&!t.y.equals(1))&&!!t.isOnCurve()))},sjcl.ecc.point.prototype.isOnCurve=function(){var t=this,e=(t.curve.r,t.curve.a),s=t.curve.b,i=t.curve.field.modulus,r=t.y.mul(t.y).mod(i),n=t.x.mul(t.x).mul(t.x).add(e.mul(t.x)).add(s).mod(i);return r.equals(n)},sjcl.ecc.point.prototype.toString=function(){return"("+this.x.toString()+", "+this.y.toString()+")"},sjcl.ecc.pointJac.prototype.toString=function(){return"("+this.x.toString()+", "+this.y.toString()+", "+this.z.toString()+")"},sjcl.ecc.curves.c256=new sjcl.ecc.curve(sjcl.bn.pseudoMersennePrime(256,[[0,-1],[4,-1],[6,-1],[7,-1],[8,-1],[9,-1],[32,-1]]),"0x14551231950b75fc4402da1722fc9baee",0,7,"0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8"),sjcl.ecc.pointJac.prototype.add=function(t){var e=this;if(e.curve!==t.curve)throw"sjcl.ecc.add(): Points must be on the same curve to add them!";if(e.isIdentity)return t.toJac();if(t.isIdentity)return e;var s=e.z.square(),i=t.x.mul(s).subM(e.x),r=t.y.mul(e.z).mul(s);if(i.equals(0))return e.y.equals(t.y.mul(s.mul(e.z)))?e.doubl():new sjcl.ecc.pointJac(e.curve);var n=i.square(),c=n.copy().doubleM().doubleM(),o=i.mul(c),l=r.sub(e.y).doubleM(),a=e.x.mul(c),h=l.square().subM(o).subM(a.copy().doubleM()),u=l.mul(a.sub(h)).subM(e.y.mul(o).doubleM()),f=e.z.add(i).square().subM(s).subM(n);return new sjcl.ecc.pointJac(this.curve,h,u,f)},sjcl.ecc.pointJac.prototype.doubl=function(){if(this.isIdentity)return this;var t=this.x.square(),e=this.y.square(),s=e.square(),i=this.x.add(e).square().subM(t).subM(s).doubleM(),r=t.mul(3),n=r.square(),c=n.sub(i.copy().doubleM()),o=r.mul(i.sub(c)).subM(s.doubleM().doubleM().doubleM()),l=this.z.mul(this.y).doubleM();return new sjcl.ecc.pointJac(this.curve,c,o,l)},sjcl.ecc.point.prototype.toBytesCompressed=function(){var t="0x0"==this.y.mod(2).toString()?2:3;return[t].concat(sjcl.codec.bytes.fromBits(this.x.toBits()))},function(){function t(t,e,s){return t^e^s}function e(t,e,s){return t&e|~t&s}function s(t,e,s){return(t|~e)^s}function i(t,e,s){return t&s|e&~s}function r(t,e,s){return t^(e|~s)}function n(t,e){return t<<e|t>>>32-e}function c(t){return(255&t)<<24|(65280&t)<<8|(t&255<<16)>>>8|(t&255<<24)>>>24}function o(c){for(var o,l=this._h[0],u=this._h[1],f=this._h[2],_=this._h[3],g=this._h[4],j=this._h[0],v=this._h[1],y=this._h[2],w=this._h[3],E=this._h[4],x=0;x<16;++x)o=n(l+t(u,f,_)+c[d[x]]+a[x],p[x])+g,l=g,g=_,_=n(f,10),f=u,u=o,o=n(j+r(v,y,w)+c[b[x]]+h[x],m[x])+E,j=E,E=w,w=n(y,10),y=v,v=o;for(;x<32;++x)o=n(l+e(u,f,_)+c[d[x]]+a[x],p[x])+g,l=g,g=_,_=n(f,10),f=u,u=o,o=n(j+i(v,y,w)+c[b[x]]+h[x],m[x])+E,j=E,E=w,w=n(y,10),y=v,v=o;for(;x<48;++x)o=n(l+s(u,f,_)+c[d[x]]+a[x],p[x])+g,l=g,g=_,_=n(f,10),f=u,u=o,o=n(j+s(v,y,w)+c[b[x]]+h[x],m[x])+E,j=E,E=w,w=n(y,10),y=v,v=o;for(;x<64;++x)o=n(l+i(u,f,_)+c[d[x]]+a[x],p[x])+g,l=g,g=_,_=n(f,10),f=u,u=o,o=n(j+e(v,y,w)+c[b[x]]+h[x],m[x])+E,j=E,E=w,w=n(y,10),y=v,v=o;for(;x<80;++x)o=n(l+r(u,f,_)+c[d[x]]+a[x],p[x])+g,l=g,g=_,_=n(f,10),f=u,u=o,o=n(j+t(v,y,w)+c[b[x]]+h[x],m[x])+E,j=E,E=w,w=n(y,10),y=v,v=o;o=this._h[1]+f+w,this._h[1]=this._h[2]+_+E,this._h[2]=this._h[3]+g+j,this._h[3]=this._h[4]+l+v,this._h[4]=this._h[0]+u+y,this._h[0]=o}sjcl.hash.ripemd160=function(t){t?(this._h=t._h.slice(0),this._buffer=t._buffer.slice(0),this._length=t._length):this.reset()},sjcl.hash.ripemd160.hash=function(t){return(new sjcl.hash.ripemd160).update(t).finalize()},sjcl.hash.ripemd160.prototype={reset:function(){return this._h=l.slice(0),this._buffer=[],this._length=0,this},update:function(t){"string"==typeof t&&(t=sjcl.codec.utf8String.toBits(t));var e,s=this._buffer=sjcl.bitArray.concat(this._buffer,t),i=this._length,r=this._length=i+sjcl.bitArray.bitLength(t);for(e=512+i&-512;e<=r;e+=512){for(var n=s.splice(0,16),l=0;l<16;++l)n[l]=c(n[l]);o.call(this,n)}return this},finalize:function(){var t=sjcl.bitArray.concat(this._buffer,[sjcl.bitArray.partial(1,1)]),e=(this._length+1)%512,s=(e>448?512:448)-e%448,i=s%32;for(i>0&&(t=sjcl.bitArray.concat(t,[sjcl.bitArray.partial(i,0)]));s>=32;s-=32)t.push(0);for(t.push(c(0|this._length)),t.push(c(Math.floor(this._length/4294967296)));t.length;){for(var r=t.splice(0,16),n=0;n<16;++n)r[n]=c(r[n]);o.call(this,r)}var l=this._h;this.reset();for(n=0;n<5;++n)l[n]=c(l[n]);return l}};for(var l=[1732584193,4023233417,2562383102,271733878,3285377520],a=[0,1518500249,1859775393,2400959708,2840853838],h=[1352829926,1548603684,1836072691,2053994217,0],u=4;u>=0;--u)for(var f=1;f<16;++f)a.splice(u,0,a[u]),h.splice(u,0,h[u]);var d=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],b=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],p=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],m=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]}(),sjcl.bn.ZERO=new sjcl.bn(0),sjcl.bn.prototype.divRem=function(t){"object"!=typeof t&&(t=new this._class(t));var e=this.abs(),s=t.abs(),i=new this._class(0),r=0;if(!e.greaterEquals(s))return[new sjcl.bn(0),this.copy()];if(e.equals(s))return[new sjcl.bn(1),new sjcl.bn(0)];for(;e.greaterEquals(s);r++)s.doubleM();for(;r>0;r--)i.doubleM(),s.halveM(),e.greaterEquals(s)&&(i.addM(1),e.subM(t).normalize());return[i,e]},sjcl.bn.prototype.divRound=function(t){var e=this.divRem(t),s=e[0],i=e[1];return i.doubleM().greaterEquals(t)&&s.addM(1),s},sjcl.bn.prototype.div=function(t){var e=this.divRem(t);return e[0]},sjcl.bn.prototype.sign=function(){return this.greaterEquals(sjcl.bn.ZERO)?1:-1},sjcl.bn.prototype.neg=function(){return sjcl.bn.ZERO.sub(this)},sjcl.bn.prototype.abs=function(){return-1===this.sign()?this.neg():this},sjcl.bn.prototype.shiftRight=function(t){if("number"!=typeof t)throw new Error("shiftRight expects a number");if(t=+t,t<0)return this.shiftLeft(t);for(var e=new sjcl.bn(this);t>=this.radix;)e.limbs.shift(),t-=this.radix;for(;t--;)e.halveM();return e},sjcl.bn.prototype.shiftLeft=function(t){if("number"!=typeof t)throw new Error("shiftLeft expects a number");if(t=+t,t<0)return this.shiftRight(t);for(var e=new sjcl.bn(this);t>=this.radix;)e.limbs.unshift(0),t-=this.radix;for(;t--;)e.doubleM();return e},sjcl.bn.prototype.toNumber=function(){return 0|this.limbs[0]},sjcl.bn.prototype.testBit=function(t){var e=Math.floor(t/this.radix),s=t%this.radix;return e>=this.limbs.length?0:this.limbs[e]>>>s&1},sjcl.bn.prototype.setBitM=function(t){for(var e=Math.floor(t/this.radix),s=t%this.radix;e>=this.limbs.length;)this.limbs.push(0);return this.limbs[e]|=1<<s,this.cnormalize(),this},sjcl.bn.prototype.modInt=function(t){return this.toNumber()%t},sjcl.bn.prototype.invDigit=function(){var t=1+this.radixMask;if(this.limbs.length<1)return 0;var e=this.limbs[0];if(0==(1&e))return 0;var s=3&e;return s=s*(2-(15&e)*s)&15,s=s*(2-(255&e)*s)&255,s=s*(2-((65535&e)*s&65535))&65535,s=s*(2-e*s%t)%t,s>0?t-s:-s},sjcl.bn.prototype.am=function(t,e,s,i,r,n){for(var c=4095&e,o=e>>12;--n>=0;){var l=4095&this.limbs[t],a=this.limbs[t++]>>12,h=o*l+a*c;l=c*l+((4095&h)<<12)+s.limbs[i]+r,r=(l>>24)+(h>>12)+o*a,s.limbs[i++]=16777215&l}return r};var FIELD_MODULUS_PLUS_ONE_DIVIDED_BY_FOUR,Montgomery=function(t){this.m=t,this.mt=t.limbs.length,this.mt2=2*this.mt,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.radix-15)-1};Montgomery.prototype.reduce=function(t){for(var e=t.radixMask+1;t.limbs.length<=this.mt2;)t.limbs[t.limbs.length]=0;for(var s=0;s<this.mt;++s){var i=32767&t.limbs[s],r=i*this.mpl+((i*this.mph+(t.limbs[s]>>15)*this.mpl&this.um)<<15)&t.radixMask;for(i=s+this.mt,t.limbs[i]+=this.m.am(0,r,t,s,0,this.mt);t.limbs[i]>=e;)t.limbs[i]-=e,t.limbs[++i]++}return t.trim(),t=t.shiftRight(this.mt*this.m.radix),t.greaterEquals(this.m)&&(t=t.sub(this.m)),t.trim().normalize().reduce()},Montgomery.prototype.square=function(t){return this.reduce(t.square())},Montgomery.prototype.multiply=function(t,e){return this.reduce(t.mul(e))},Montgomery.prototype.convert=function(t){return t.abs().shiftLeft(this.mt*this.m.radix).mod(this.m)},Montgomery.prototype.revert=function(t){return this.reduce(t.copy())},sjcl.bn.prototype.powermodMontgomery=function(t,e){var s,i=t.bitLength(),r=new this._class(1);if(i<=0)return r;if(s=i<18?1:i<48?3:i<144?4:i<768?5:6,i<8||!e.testBit(0))return this.powermod(t,e);var n=new Montgomery(e);t.trim().normalize();var c=new Array,o=3,l=s-1,a=(1<<s)-1;if(c[1]=n.convert(this),s>1)for(var h=n.square(c[1]);o<=a;)c[o]=n.multiply(h,c[o-2]),o+=2;var u,f,d=t.limbs.length-1,b=!0,p=new this._class;for(i=nbits(t.limbs[d])-1;d>=0;){for(i>=l?u=t.limbs[d]>>i-l&a:(u=(t.limbs[d]&(1<<i+1)-1)<<l-i,d>0&&(u|=t.limbs[d-1]>>this.radix+i-l)),o=s;0==(1&u);)u>>=1,--o;if((i-=o)<0&&(i+=this.radix,--d),b)r=c[u].copy(),b=!1;else{for(;o>1;)p=n.square(r),r=n.square(p),o-=2;o>0?p=n.square(r):(f=r,r=p,p=f),r=n.multiply(p,c[u])}for(;d>=0&&0==(t.limbs[d]&1<<i);)p=n.square(r),f=r,r=p,p=f,--i<0&&(i=this.radix-1,--d)}return n.revert(r)},sjcl.ecc.ecdsa.secretKey.prototype.sign=function(t,e,s){var i,r=this._curve.r,n=r.bitLength();i="object"==typeof s&&s.length>0&&"number"==typeof s[0]?s:"string"==typeof s&&/^[0-9a-fA-F]+$/.test(s)?sjcl.bn.fromBits(sjcl.codec.hex.toBits(s)):sjcl.bn.random(r.sub(1),e).add(1);var c=this._curve.G.mult(i).x.mod(r),o=sjcl.bn.fromBits(t).add(c.mul(this._exponent)).mul(i.inverseMod(r)).mod(r);return sjcl.bitArray.concat(c.toBits(n),o.toBits(n))},sjcl.ecc.ecdsa.publicKey.prototype.verify=function(t,e){var s=sjcl.bitArray,i=this._curve.r,r=i.bitLength(),n=sjcl.bn.fromBits(s.bitSlice(e,0,r)),c=sjcl.bn.fromBits(s.bitSlice(e,r,2*r)),o=c.inverseMod(i),l=sjcl.bn.fromBits(t).mul(o).mod(i),a=n.mul(o).mod(i),h=this._curve.G.mult2(l,a,this._point).x;if(n.equals(0)||c.equals(0)||n.greaterEquals(i)||c.greaterEquals(i)||!h.equals(n))throw new sjcl.exception.corrupt("signature didn't check out");return!0},sjcl.ecc.ecdsa.secretKey.prototype.canonicalizeSignature=function(t){var e=sjcl.bitArray,s=this._curve.r,i=s.bitLength(),r=sjcl.bn.fromBits(e.bitSlice(t,0,i)),n=sjcl.bn.fromBits(e.bitSlice(t,i,2*i));return s.copy().halveM().greaterEquals(n)||(n=s.sub(n)),e.concat(r.toBits(i),n.toBits(i))},sjcl.ecc.ecdsa.secretKey.prototype.signDER=function(t,e){return this.encodeDER(this.sign(t,e))},sjcl.ecc.ecdsa.secretKey.prototype.encodeDER=function(t){for(var e=sjcl.bitArray,s=this._curve.r,i=s.bitLength(),r=sjcl.codec.bytes.fromBits(e.bitSlice(t,0,i)),n=sjcl.codec.bytes.fromBits(e.bitSlice(t,i,2*i));!r[0]&&r.length;)r.shift();for(;!n[0]&&n.length;)n.shift();128&r[0]&&r.unshift(0),128&n[0]&&n.unshift(0);var c=[].concat(48,4+r.length+n.length,2,r.length,r,2,n.length,n);return sjcl.codec.bytes.toBits(c)},sjcl.ecc.ecdsa.secretKey.prototype.signWithRecoverablePublicKey=function(t,e,s){var i,r=this;if(!("object"==typeof t&&t.length>0&&"number"==typeof t[0]))throw new sjcl.exception.invalid("hash. Must be a bitArray");i=t;var n=r.sign(i,e,s),c=r.canonicalizeSignature(n),o=getRandSFromSignature(r._curve,c),l=r._curve.G.mult(sjcl.bn.fromBits(r.get())),a=calculateRecoveryFactor(r._curve,o.r,o.s,i,l),h=a+27,u=sjcl.bitArray.concat([h],c);return u},sjcl.ecc.ecdsa.publicKey.recoverFromSignature=function(t,e,s){if(!e||e instanceof sjcl.ecc.curve)throw new sjcl.exception.invalid("must supply hash and signature to recover public key");var i,r;if(s||(s=sjcl.ecc.curves.c256),!("object"==typeof t&&t.length>0&&"number"==typeof t[0]))throw new sjcl.exception.invalid("hash. Must be a bitArray");if(i=t,!("object"==typeof e&&e.length>0&&"number"==typeof e[0]))throw new sjcl.exception.invalid("signature. Must be a bitArray");r=e;var n=r[0]-27;if(n<0||n>3)throw new sjcl.exception.invalid("signature. Signature must be generated with algorithm that prepends the recovery factor in order to recover the public key");var c=getRandSFromSignature(s,r.slice(1)),o=c.r,l=c.s,a=recoverPublicKeyPointFromSignature(s,o,l,i,n),h=new sjcl.ecc.ecdsa.publicKey(s,a);return h},sjcl.bn.prototype.jacobi=function(t){var e=this;if(t=new sjcl.bn(t),-1!==t.sign()){if(e.equals(0))return 0;if(e.equals(1))return 1;for(var s=0,i=0;!e.testBit(i);)i++;var r=e.shiftRight(i);if(0==(1&i))s=1;else{var n=t.modInt(8);1===n||7===n?s=1:3!==n&&5!==n||(s=-1)}return 3===t.modInt(4)&&3===r.modInt(4)&&(s=-s),r.equals(1)?s:s*t.mod(r).jacobi(r)}};